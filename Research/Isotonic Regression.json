{"paragraphs":[{"text":"%pyspark\n\nfrom pyspark.sql.types import *\nfrom pyspark.sql.functions import *\nfrom pyspark.sql import SparkSession","user":"anonymous","dateUpdated":"2019-06-17T19:07:35+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257408_2054411599","id":"20190617-180708_805080349","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:3370","dateFinished":"2019-06-17T19:07:35+0000","dateStarted":"2019-06-17T19:07:35+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\nfrom pyspark.ml import Pipeline\nfrom pyspark.ml.feature import VectorAssembler, StringIndexer, VectorIndexer\nfrom pyspark.ml.tuning import CrossValidator, ParamGridBuilder, TrainValidationSplit\n\nfrom pyspark.ml.regression import IsotonicRegression\nfrom pyspark.ml.evaluation import RegressionEvaluator\n\nfrom pyspark.sql import SQLContext\nsqlContext = SQLContext(sc)\nimport sys","user":"anonymous","dateUpdated":"2019-06-17T19:07:35+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257409_1364830461","id":"20190617-182106_743368908","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3371","dateFinished":"2019-06-17T19:07:35+0000","dateStarted":"2019-06-17T19:07:35+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\nratings_all = spark.read.csv('s3://monikamishrabucket/review_us.tsv',inferSchema=True, header=True,sep=\"\\t\")\n\nratings_all.createOrReplaceTempView(\"table1\") \n\ntsv = spark.sql(\"SELECT * FROM table1\")\n\ntsv1 = tsv.select(\"product_id\", \"product_parent\", \"product_title\", \"product_category\", \"helpful_votes\", \"total_votes\", \"vine\", \"verified_purchase\", \"review_headline\", \"review_body\", \"review_date\",\"star_rating\" )\n\n","user":"anonymous","dateUpdated":"2019-06-17T19:07:35+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257410_284444476","id":"20190616-224955_801932534","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3372","dateFinished":"2019-06-17T19:08:35+0000","dateStarted":"2019-06-17T19:07:36+0000","results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=137","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=138"],"interpreterSettingId":"spark"}}},{"text":"%pyspark\n\ndf1 = tsv1.filter(tsv1.product_category.isNotNull())\ndf2 = df1.filter(df1.helpful_votes.isNotNull())\ndf3 = df2.filter(df2.total_votes.isNotNull())\ndf4 = df3.filter(df3.vine.isNotNull())\ndf5 = df4.filter(df4.verified_purchase.isNotNull())\ndf6 = df5.filter(df5.review_headline.isNotNull())\ndf7 = df6.filter(df6.review_body.isNotNull())\ndf8 = df7.filter(df7.review_date.isNotNull())\ndf9 = df8.filter(df8.star_rating.isNotNull())\n\ndata = df9.select(\"product_id\", \"product_parent\", \"product_title\", \"product_category\", \"helpful_votes\", \"total_votes\", \"vine\", \"verified_purchase\",col(\"star_rating\").alias(\"label\"))\n","user":"anonymous","dateUpdated":"2019-06-17T19:08:35+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257411_1653815740","id":"20190616-225033_620055753","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3373","dateFinished":"2019-06-17T19:08:36+0000","dateStarted":"2019-06-17T19:08:36+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\ndata = StringIndexer(inputCol='product_id', outputCol='product_id'+\"_index\").fit(data).transform(data)\ndata = StringIndexer(inputCol='product_title', outputCol='product_title'+\"_index\").fit(data).transform(data)\ndata = StringIndexer(inputCol='product_category', outputCol='product_category'+\"_index\").fit(data).transform(data)\ndata = StringIndexer(inputCol='vine', outputCol='vine'+\"_index\").fit(data).transform(data)\ndata = StringIndexer(inputCol='verified_purchase', outputCol='verified_purchase'+\"_index\").fit(data).transform(data)\n\n","user":"anonymous","dateUpdated":"2019-06-17T19:08:36+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257411_-1032018828","id":"20190616-225054_543542983","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3374","dateFinished":"2019-06-17T19:11:36+0000","dateStarted":"2019-06-17T19:08:36+0000","results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=139","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=140","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=141","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=142","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=143"],"interpreterSettingId":"spark"}}},{"text":"%pyspark\n\n# Split the data\nsplits = data.randomSplit([0.7, 0.3])\n\n\nit_train = splits[0]\nit_test = splits[1].withColumnRenamed(\"label\", \"trueLabel\")\n\nprint (\"Training Rows:\", it_train.count(), \" Testing Rows:\", it_test.count())\n","user":"anonymous","dateUpdated":"2019-06-17T19:11:36+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257412_329254005","id":"20190616-225154_94512759","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3375","dateFinished":"2019-06-17T19:13:10+0000","dateStarted":"2019-06-17T19:11:36+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"('Training Rows:', 4853262, ' Testing Rows:', 2077207)\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=144","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=145"],"interpreterSettingId":"spark"}}},{"text":"%pyspark\n\nassembler = VectorAssembler(inputCols = [\"product_parent\", \"helpful_votes\", \"total_votes\", \"product_id_index\", \"product_title_index\", \"product_category_index\", \"vine_index\", \"verified_purchase_index\"], outputCol=\"features\")","user":"anonymous","dateUpdated":"2019-06-17T19:13:10+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257412_1140465021","id":"20190616-225247_811195240","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3376","dateFinished":"2019-06-17T19:13:11+0000","dateStarted":"2019-06-17T19:13:11+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\nit = IsotonicRegression(labelCol=\"label\",featuresCol=\"features\")\nit_pipeline = Pipeline(stages=[assembler, it])\n","user":"anonymous","dateUpdated":"2019-06-17T19:13:11+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257413_29661064","id":"20190616-224641_1388003167","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3377","dateFinished":"2019-06-17T19:13:11+0000","dateStarted":"2019-06-17T19:13:11+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\nparamGrid = ParamGridBuilder().build()\ncv = CrossValidator(estimator=it_pipeline, evaluator=RegressionEvaluator(), estimatorParamMaps=paramGrid, numFolds=5)\n","user":"anonymous","dateUpdated":"2019-06-17T19:13:11+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257413_-528169380","id":"20190616-224612_614156143","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3378","dateFinished":"2019-06-17T19:13:11+0000","dateStarted":"2019-06-17T19:13:11+0000","results":{"code":"SUCCESS","msg":[]}},{"text":"%pyspark\n\nit_model = cv.fit(it_train)\n","user":"anonymous","dateUpdated":"2019-06-17T19:13:11+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257414_672673184","id":"20190616-222520_1844834092","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3379","dateFinished":"2019-06-17T19:27:55+0000","dateStarted":"2019-06-17T19:13:11+0000","results":{"code":"SUCCESS","msg":[]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=146","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=147","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=148","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=149","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=150","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=151","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=152","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=153","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=154","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=155","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=156","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=157","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=158","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=159","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=160","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=161","http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=162"],"interpreterSettingId":"spark"}}},{"text":"%pyspark\n\nit_prediction = it_model.transform(it_test)\nit_predicted =it_prediction.select(\"features\", \"prediction\", \"trueLabel\")\nit_predicted.show(10)","user":"anonymous","dateUpdated":"2019-06-17T19:27:55+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257415_1380290730","id":"20190616-222712_1778416023","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3380","dateFinished":"2019-06-17T19:28:03+0000","dateStarted":"2019-06-17T19:27:55+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"+--------------------+-----------------+---------+\n|            features|       prediction|trueLabel|\n+--------------------+-----------------+---------+\n|[2.75786765E8,1.0...|4.292393577221169|        4|\n|[2.75786765E8,11....|4.292393577221169|        5|\n|[9.15528414E8,0.0...|4.338638689667786|        5|\n|[4.98635851E8,0.0...| 4.31009269485674|        5|\n|[5.94264062E8,0.0...| 4.31009269485674|        5|\n|[5.94264062E8,1.0...| 4.31009269485674|        5|\n|[5.94264062E8,1.0...| 4.31009269485674|        4|\n|[5.94264062E8,2.0...| 4.31009269485674|        5|\n|[5.94264062E8,2.0...| 4.31009269485674|        5|\n|[5.94264062E8,2.0...| 4.31009269485674|        5|\n+--------------------+-----------------+---------+\nonly showing top 10 rows\n\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=163"],"interpreterSettingId":"spark"}}},{"text":"%pyspark\n\nit_evaluator = RegressionEvaluator(labelCol=\"trueLabel\", predictionCol=\"prediction\", metricName=\"rmse\")\nit_rmse = it_evaluator.evaluate(it_prediction)\nprint (\"Root Mean Square Error (RMSE):\", it_rmse)","user":"anonymous","dateUpdated":"2019-06-17T19:28:03+0000","config":{"editorSetting":{"language":"python","editOnDblClick":false,"completionKey":"TAB","completionSupport":true},"colWidth":12,"editorMode":"ace/mode/python","fontSize":9,"results":{},"enabled":true},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560798257415_-379717439","id":"20190616-223152_1636117903","dateCreated":"2019-06-17T19:04:17+0000","status":"FINISHED","progressUpdateIntervalMs":500,"$$hashKey":"object:3381","dateFinished":"2019-06-17T19:29:00+0000","dateStarted":"2019-06-17T19:28:03+0000","results":{"code":"SUCCESS","msg":[{"type":"TEXT","data":"('Root Mean Square Error (RMSE):', 1.1469033211180577)\n"}]},"runtimeInfos":{"jobUrl":{"propertyName":"jobUrl","label":"SPARK JOB","tooltip":"View in Spark web UI","group":"spark","values":["http://ip-172-31-8-68.us-west-1.compute.internal:4040/jobs/job?id=164"],"interpreterSettingId":"spark"}}},{"text":"%pyspark\n","user":"anonymous","dateUpdated":"2019-06-17T19:28:03+0000","config":{"colWidth":12,"fontSize":9,"enabled":true,"results":{},"editorSetting":{}},"settings":{"params":{},"forms":{}},"apps":[],"jobName":"paragraph_1560799683874_630955163","id":"20190617-192803_2107933347","dateCreated":"2019-06-17T19:28:03+0000","status":"READY","progressUpdateIntervalMs":500,"focus":true,"$$hashKey":"object:4463"}],"name":"Isotonic Regression","id":"2EE6J12H9","noteParams":{},"noteForms":{},"angularObjects":{"spark:shared_process":[]},"config":{"isZeppelinNotebookCronEnable":false,"looknfeel":"default","personalizedMode":"false"},"info":{}}